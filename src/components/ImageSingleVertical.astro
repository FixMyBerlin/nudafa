---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

interface Props {
  src: string;
  alt: string;
  caption: string;
  imageConfig: {
    discriminant: "half" | "full";
    value: "center" | "right" | "left";
  };
}
const { src, alt, caption, imageConfig } = Astro.props;
const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/**/*.{jpeg,jpg,png,gif,webp,JPG,JPEG,PNG,GIF}"
);
if (!images[src])
  throw new Error(
    `"${src}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif}"`
  );

const width = imageConfig.discriminant;
const position = imageConfig.value;
---

<div
  class:list={[
    position === "center" && "justify-center",
    position === "right" && "justify-end",
    "w-full flex",
  ]}
>
  <figure class:list={[width === "half" ? "w-full md:w-1/2" : "w-full"]}>
    <div class:list={["aspect-[3/4]"]}>
      <!-- quality="high" -->
      <!-- https://docs.astro.build/en/guides/images/#quality -->
      <Image
        class="w-full h-full overflow-hidden object-cover"
        src={images[src]()}
        alt={alt || ""}
        loading="lazy"
      />
    </div>
    <figcaption>{caption}</figcaption>
  </figure>
</div>
